---
title: "Homework 2 - Report"
CJKmainfont: SimSun
author: "3170105743 李政达"
date: "2020/7/7"
output:
  pdf_document:
    includes:
      header-includes:
        - \usepackage{xeCJK}
    keep_tex: no
    latex_engine: xelatex




---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

The data set calif_penn_2011.csv contains information about the housing stock of California and Pennsylvania, as of 2011.  Information as aggregated into "Census tracts", geographic regions of a few thousand people which are supposed to be fairly homogeneous economically and socially.

1. _Loading and cleaning_

a. Load the data into a dataframe called `ca_pa`.

```{r}
ca_pa <- read.csv("../data/calif_penn_2011.csv", header = TRUE, sep = ",")
```

b. How many rows and columns does the dataframe have?

```{r}
rows <- dim(ca_pa)[1]
columns <- dim(ca_pa)[2]
```

c. Run this command, and explain, in words, what this does:

**Ans:** this command can figure out the number of missing values in every column.

```{r}
colSums(apply(ca_pa,c(1,2),is.na))
```

d. The function `na.omit()` takes a dataframe and returns a new dataframe, omitting any row containing an NA value.  Use it to purge the data set of rows with incomplete data.

```{r}
ca_pa <- na.omit(ca_pa)
```

e. How many rows did this eliminate?

```{r}
rows - dim(ca_pa)[1]
```

f. Are your answers in (c) and (e) compatible? Explain.

**Ans:** They are compatible. The command in (c) check the number of missing values in every column, and the command in (e) check the number of rows with incomplete data. We can infer that after purging, the number of missing values in every column will be zero. And we can use the command below to check out the truth.

```{r}
sum(colSums(apply(ca_pa,c(1,2),is.na)))
```

2. _This Very New House_ 

a. The variable `Built_2005_or_later` indicates the percentage of houses in each Census tract built since 2005.  Plot median house prices against this variable.

```{r}
plot(ca_pa$Median_house_value, ca_pa$Built_2005_or_later,
     xlab = "median house prices",
     ylab = "percentage of houses built since 2005")
```

b. Make a new plot, or pair of plots, which breaks this out by state.  Note that the state is recorded in the `STATEFP` variable, with California being state 6 and Pennsylvania state 42.

```{r}
plot(ca_pa$Median_house_value[ca_pa$STATEFP == 6],
     ca_pa$Built_2005_or_later[ca_pa$STATEFP == 6],
     xlab = "median house prices",
     ylab = "percentage of houses built since 2005",
     main = "Houses in California")
plot(ca_pa$Median_house_value[ca_pa$STATEFP == 42],
     ca_pa$Built_2005_or_later[ca_pa$STATEFP == 42],
     xlab = "median house prices",
     ylab = "percentage of houses built since 2005",
     main = "Houses in Pennsylvania")
```

3. _Nobody Home_

The vacancy rate is the fraction of housing units which are not occupied.  The dataframe contains columns giving the total number of housing units for each Census tract, and the number of vacant housing units.  

a. Add a new column to the dataframe which contains the vacancy rate.  What are the minimum, maximum, mean, and median vacancy rates?

```{r}
Vacancy_rate <- ca_pa$Vacant_units / ca_pa$Total_units
ca_pa <- data.frame(ca_pa, Vacancy_rate)
max(Vacancy_rate)
min(Vacancy_rate)
mean(Vacancy_rate)
median(Vacancy_rate)
```

b. Plot the vacancy rate against median house value.

```{r}
plot(ca_pa$Median_house_value, ca_pa$Vacancy_rate,
     xlab = "median house prices", ylab = "vacancy rate")
```

c. Plot vacancy rate against median house value separately for California and for Pennsylvania.  Is there a difference?

```{r}
plot(ca_pa$Median_house_value[ca_pa$STATEFP == 6],
     ca_pa$Vacancy_rate[ca_pa$STATEFP == 6],
     xlab = "median house prices", ylab = "vacancy rate",
     main = "Houses in California")
plot(ca_pa$Median_house_value[ca_pa$STATEFP == 42],
     ca_pa$Vacancy_rate[ca_pa$STATEFP == 42],
     xlab = "median house prices", ylab = "vacancy rate",
     main = "Houses in Pennsylvania")
```

4. The column `COUNTYFP` contains a numerical code for counties within each state.  We are interested in Alameda County (county 1 in California), Santa Clara (county 85 in California), and Allegheny County (county 3 in Pennsylvania).

a. Explain what the block of code at the end of this question is supposed to accomplish, and how it does it.

**Ans:** This block of code is supposed to pick up the tracts in Alameda County and compute the median of the median house values of those tracts. The code firstly traverse all the tracts in `ca_pa`, and if a tract matches condition, it will be stored in a new vector `acca`. Then the code traverse again to store the median house values of the tracts in `acca` into `accamhv`. Finally the code call `median` function to compute the median of `accamhv`.

b. Give a single line of R which gives the same final answer as the block of code.  Note: there are at least two ways to do this; you just have to find one.

```{r}
median(ca_pa$Median_house_value[ca_pa$STATEFP == 6 & ca_pa$COUNTYFP == 1])
```

c. For Alameda, Santa Clara and Allegheny Counties, what were the average percentages of housing built since 2005?

```{r}
# Alameda
mean(ca_pa$Built_2005_or_later[ca_pa$STATEFP == 6 & ca_pa$COUNTYFP == 1])
# Santa Clara
mean(ca_pa$Built_2005_or_later[ca_pa$STATEFP == 6 & ca_pa$COUNTYFP == 85])
# Allegheny
mean(ca_pa$Built_2005_or_later[ca_pa$STATEFP == 42 & ca_pa$COUNTYFP == 3])
```

d. The `cor` function calculates the correlation coefficient between two variables.  What is the correlation between median house value and the percent of housing built since 2005 in (i) the whole data, (ii) all of California, (iii) all of Pennsylvania, (iv) Alameda County, (v) Santa Clara County and (vi) Allegheny County?

```{r}
# (i) the whole data
cor(ca_pa$Median_house_value, ca_pa$Built_2005_or_later)
# (ii) all of California
cor(ca_pa$Median_house_value[ca_pa$STATEFP == 6],
    ca_pa$Built_2005_or_later[ca_pa$STATEFP == 6])
# (iii) all of Pennsylvania
cor(ca_pa$Median_house_value[ca_pa$STATEFP == 42],
    ca_pa$Built_2005_or_later[ca_pa$STATEFP == 42])
# (iv) Alameda
cor(ca_pa$Median_house_value[ca_pa$STATEFP == 6 & ca_pa$COUNTYFP == 1],
    ca_pa$Built_2005_or_later[ca_pa$STATEFP == 6 & ca_pa$COUNTYFP == 1])
# (v) Santa Clara
cor(ca_pa$Median_house_value[ca_pa$STATEFP == 6 & ca_pa$COUNTYFP == 85],
    ca_pa$Built_2005_or_later[ca_pa$STATEFP == 6 & ca_pa$COUNTYFP == 85])
# (vi) Allegheny
cor(ca_pa$Median_house_value[ca_pa$STATEFP == 42 & ca_pa$COUNTYFP == 3],
    ca_pa$Built_2005_or_later[ca_pa$STATEFP == 42 & ca_pa$COUNTYFP == 3])
```

e. Make three plots, showing median house values against median income, for Alameda, Santa Clara, and Allegheny Counties.  (If you can fit the information into one plot, clearly distinguishing the three counties, that's OK too.)

```{r}
#Alameda
plot(ca_pa$Median_house_value[ca_pa$STATEFP == 6 & ca_pa$COUNTYFP == 1],
     ca_pa$Median_household_income[ca_pa$STATEFP == 6 & ca_pa$COUNTYFP == 1],
     xlab = "median house values", ylab = "median income",
     main = "Houses in Alameda")
# Santa Clara
plot(ca_pa$Median_house_value[ca_pa$STATEFP == 6 & ca_pa$COUNTYFP == 85],
     ca_pa$Median_household_income[ca_pa$STATEFP == 6 & ca_pa$COUNTYFP == 85],
     xlab = "median house values", ylab = "median income",
     main = "Houses in Santa Clara")
# Allegheny
plot(ca_pa$Median_house_value[ca_pa$STATEFP == 42 & ca_pa$COUNTYFP == 3],
     ca_pa$Median_household_income[ca_pa$STATEFP == 42 & ca_pa$COUNTYFP == 3],
     xlab = "median house values", ylab = "median income",
     main = "Houses in Allegheny")
```

```{r, eval=FALSE}
acca <- c()
for (tract in 1:nrow(ca_pa)) {
  if (ca_pa$STATEFP[tract] == 6) {
    if (ca_pa$COUNTYFP[tract] == 1) {
      acca <- c(acca, tract)
    }
  }
}
accamhv <- c()
for (tract in acca) {
  accamhv <- c(accamhv, ca_pa[tract,10])
}
median(accamhv)
```